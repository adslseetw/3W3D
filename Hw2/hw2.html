<!DOCTYPE html>
<html>
<head>
<style>
	#info {
		position: absolute;
		top: 0px; width: 100%;
		font-family: Monospace;
		font-size: 20px;
		padding: 5px;
		text-align: center;
		color: #FF8000
	}
</style>
</head>

<body>
<audio id="open_door" style="display:none">
<source src="../music/wood_door_open.mp3" type='audio/mp3'>
</audio>
<audio id="close_door" style="display:none">
<source src="../music/wood_door_close.mp3" type='audio/mp3'>
</audio>

<div id="info">
	<a href="javascript:tuggle();">tuggle</a>
	<br/>
</div>
<script src="../js/three.min.js"></script>
<script src="../js/OrbitControls.js"></script>

<script>


var scene, renderer, camera,turn = false,sign = -0.020,c = Math.PI/2;;
var controls,open_sound,close_sound;
var angle = Math.PI/2;
init();
animate();

function init()
{
    open_sound = document.getElementById ('open_door');
	close_sound = document.getElementById ('close_door');
	
	renderer = new THREE.WebGLRenderer( {antialias:true} );
	var width = window.innerWidth;
	var height = window.innerHeight;
	renderer.setSize (width, height);
	document.body.appendChild (renderer.domElement);
	scene = new THREE.Scene(); //開一個空白場景
	
	//木頭材質及其灰階圖
	THREE.ImageUtils.crossOrigin = '';
    var texture = THREE.ImageUtils.loadTexture('../images/Hw3/texture_wood.png');
    var bumptex = THREE.ImageUtils.loadTexture('../images/Hw3/texture_wood_gray.png');
	//----------------------------
	//門框

    var columnGeom = new THREE.BoxGeometry(2, 42, 4);
    var platformGeom = new THREE.BoxGeometry(25, 2, 4);
    //var material = new THREE.MeshLambertMaterial();
	var material = new THREE.MeshLambertMaterial({color: 0xcec876, map: texture,bumpMap: bumptex});

    var mesh = new THREE.Mesh(columnGeom, material);
    var mesh2 = mesh.clone();
    mesh.position.set(37, 21, 0);
    mesh2.position.set(63, 21, 0);
    var mesh1 = new THREE.Mesh(platformGeom, material);
    mesh1.position.set(50, 41, 0);
    scene.add(mesh);
    scene.add(mesh1);
    scene.add(mesh2);
	//---------------------------
	//門栓
	var boltGeometry = new THREE.CylinderGeometry(0.5, 0.5, 4, 32);//上圓半徑、下圓半徑、長度
	var boltMaterial = new THREE.MeshLambertMaterial ({color: 0xbbbb44});//顏色
	var bolt = new THREE.Mesh (boltGeometry, boltMaterial);
	bolt.position.set (61.9, 30, -0.7);
	var bolt2 = bolt.clone(); 
	bolt2.position.set (61.9, 10, -0.7);
	scene.add (bolt);
	scene.add (bolt2);
	//---------------------------
	
	//門板
	frame = new THREE.Object3D();
    scene.add(frame);

	var cubeGeometry = new THREE.BoxGeometry (24,40,2); //創造一個正立方體
	var cubeMaterial = new THREE.MeshLambertMaterial({color: 0xcec876, map: texture,bumpMap: bumptex});//材質和顏色
	var cube = new THREE.Mesh (cubeGeometry, cubeMaterial);

	//cube.position.set (50, 20, 0);//正立方體之放置處
	cube.position.set (-12, 0, 0);//正立方體之放置處
	frame.add (cube);
	//---------------------------
	
	//門鎖
	var handbarGeometry = new THREE.CylinderGeometry(1, 1, 4, 32);//上圓半徑、下圓半徑、長度
	var lockGeometry = new THREE.SphereGeometry(2,60,60);
	var lockMaterial = new THREE.MeshLambertMaterial ({color: 0xbbbb44});//顏色
	var lock = new THREE.Mesh (lockGeometry, lockMaterial);
	var handbar = new THREE.Mesh (handbarGeometry, lockMaterial);
	handbar.rotation.order = 'YZX'; // default 'XYZ'
	handbar.rotation.z = angle;
	handbar.rotation.y = angle;
	handbar.position.set (-20, 0, 2);
	lock.position.set (-20, 0, 5);//門把之放置處
	frame.add (handbar);
	frame.add (lock);
	//---------------------------
	camera = new THREE.PerspectiveCamera (45, width/height, 1, 10000);//參數一:決定鏡頭所能容納的東西數量(廣角、窄)
	camera.position.y = 500;
	camera.position.z = 350;
	camera.lookAt (new THREE.Vector3(0,0,0));

	// add control here (after the camera is defined)
	controls = new THREE.OrbitControls (camera, renderer.domElement);
	
	var gridXZ = new THREE.GridHelper(100, 10);
    gridXZ.setColors(new THREE.Color(0xff0000), new THREE.Color(0xffffff));
    scene.add(gridXZ);
	
	var pointLight = new THREE.PointLight (0xffffff);
	pointLight.position.set (100,300,200);
	scene.add (pointLight);
	
	window.addEventListener ('resize', onWindowResize, false);
}

function onWindowResize ()//隨瀏覽器縮放整個場景
{
	camera.aspect = window.innerWidth / window.innerHeight;
	camera.updateProjectionMatrix();
	renderer.setSize (window.innerWidth, window.innerHeight);
}

function animate()
{
	controls.update();
	requestAnimationFrame ( animate );  
	render();
}

function render() {
     
	if(turn){
		if (frame.rotation.y < c){
			frame.rotation.y += sign;
		}else{
			frame.rotation.y -= sign;
		}

	}else{
		if (frame.rotation.y > 0){
			frame.rotation.y += sign;
			
		}else{
			frame.rotation.y -= sign;
		}
		if(frame.rotation.y < c/20 && frame.rotation.y > c/50)
			close_sound.play();
	}


    frame.rotation.y += sign;
    frame.position.set (62, 20, 0);
    renderer.render(scene, camera);
}

function tuggle()
{
	turn = !turn;
	sign *= -1;
	open_sound.play();
}
</script>
</body>

</html>